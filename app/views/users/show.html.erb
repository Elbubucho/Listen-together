<div class="card w-full bg-base-100 shadow-xl border-b">
  <div class="card-body items-center">
    <% if @is_own_profile %>
  <div class="w-full flex justify-end mb-2">
    <div class="dropdown dropdown-end">
      <div tabindex="0" role="button" class="btn btn-sm btn-primary btn-circle">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
          <path stroke-linecap="round" stroke-linejoin="round" d="M10.343 3.94c.09-.542.56-.94 1.11-.94h1.093c.55 0 1.02.398 1.11.94l.149.894c.07.424.384.764.78.93.398.164.855.142 1.205-.108l.737-.527a1.125 1.125 0 0 1 1.45.12l.773.774c.39.389.44 1.002.12 1.45l-.527.737c-.25.35-.272.806-.107 1.204.165.397.505.71.93.78l.893.15c.543.09.94.559.94 1.109v1.094c0 .55-.397 1.02-.94 1.11l-.894.149c-.424.07-.764.383-.929.78-.165.398-.143.854.107 1.204l.527.738c.32.447.269 1.06-.12 1.45l-.774.773a1.125 1.125 0 0 1-1.449.12l-.738-.527c-.35-.25-.806-.272-1.203-.107-.398.165-.71.505-.781.929l-.149.894c-.09.542-.56.94-1.11.94h-1.094c-.55 0-1.019-.398-1.11-.94l-.148-.894c-.071-.424-.384-.764-.781-.93-.398-.164-.854-.142-1.204.108l-.738.527c-.447.32-1.06.269-1.45-.12l-.773-.774a1.125 1.125 0 0 1-.12-1.45l.527-.737c.25-.35.272-.806.108-1.204-.165-.397-.506-.71-.93-.78l-.894-.15c-.542-.09-.94-.56-.94-1.109v-1.094c0-.55.398-1.02.94-1.11l.894-.149c.424-.07.765-.383.93-.78.165-.398.143-.854-.108-1.204l-.526-.738a1.125 1.125 0 0 1 .12-1.45l.773-.773a1.125 1.125 0 0 1 1.45-.12l.737.527c.35.25.807.272 1.204.107.397-.165.71-.505.78-.929l.15-.894Z" />
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
        </svg>
      </div>
      <ul
        tabindex="0"
        class="menu dropdown-content z-50 mt-2 p-0 shadow bg-base-100 rounded-lg w-52 border"
        style="border-color: #66558e; background-color: #fef7fe;"
      >
        <li>
          <%= link_to "Update profile", user_edit_profile_path(@user),
              class: "block w-full px-4 py-2 text-left" %>
        </li>
        <div class="w-full border-t" style="border-color: #66558e;"></div>
        <li>
          <%= link_to "Account settings", edit_user_registration_path(current_user),
              class: "block w-full px-4 py-2 text-left" %>
        </li>
      </ul>
    </div>
  </div>
<% end %>

    <%= render "shared/avatar", user: @user, class: "avatar w-24 h-24 mb-2" %>

    <h1 class="card-title text-2xl font-bold text-center mb-1">
      <%= @user.username.capitalize %>
    </h1>

    <% unless @is_own_profile || (@existing_friendship && @existing_friendship.confirmed?) %>
      <turbo-frame id="friendship_buttons_<%= @user.id %>">
        <div class="flex justify-center gap-3 w-full mb-4">
          <% if @existing_friendship.nil? %>
            <%= link_to "Add as friend",
                        friendships_path(receiver_id: @user.id),
                        data: { turbo_method: :post },
                        class: "btn btn-outline btn-primary" %>
          <% elsif @existing_friendship.receiver == current_user %>
            <%= link_to "Accept friend request",
                        friendship_path(@existing_friendship),
                        data: { turbo_method: :patch },
                        class: "btn btn-primary btn-outline" %>
          <% end %>
        </div>
      </turbo-frame>
    <% end %>

    <div class="flex justify-center gap-6 text-sm mb-2">
      <span class="font-semibold"><%= @user.posts.count %> posts</span>
      <span>
        <% if @is_own_profile %>
          <%= link_to "#{@friends_count} friends", friends_user_path(@user), class: "link link-primary" %>
        <% else %>
          <p><%= "#{@friends_count} friends" %></p>
        <% end %>
      </span>
    </div>

    <% if @user.bio.present? %>
      <p class="text-base-content text-center italic mb-2"><%= @user.bio %></p>
    <% end %>
  </div>
</div>

<div class="flex flex-col gap-6">
  <% if @posts.any? %>
    <% @posts.order(id: :desc).each do |post| %>
      <div class="card max-w-md bg-base-200 border border-l-2 border-primary shadow-lg shadow-2xl mx-5 sm:mx-auto p-1 my-2">
        <div class="flex items-center gap-3 pl-2 pt-2">
          <%= render "shared/avatar", user: post.user, class: "w-10 h-10" %>
          <div>
            <%= link_to post.user.username.capitalize, user_path(post.user), class: "font-semibold text-base text-base-content" %><br>
            <span><%= post.mood %></span>
          </div>
        </div>
        <div class="card-body items-center text-center">
          <p class="mb-4"><%= post.content %></p>
          <iframe src="https://open.spotify.com/embed/track/<%= post.track_id %>"
                  width="300" height="80" frameborder="0"
                  allowtransparency="true" allow="encrypted-media">
          </iframe>

          <div class="card-actions justify-start w-full mt-4 flex items-center space-x-4 px-1">
            <%= render partial: "reactions/button", locals: { post: post } %>

            <%= link_to post_path(post.id), class: "text-primary" do %>
              <svg xmlns="http://www.w3.org/2000/svg" fill="none"
                   viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"
                   class="w-6 h-6 hover:scale-110 transition">
                <path stroke-linecap="round" stroke-linejoin="round"
                      d="M12 20.25c4.97 0 9-3.694 9-8.25s-4.03-8.25-9-8.25S3 7.444 3 12c0 2.104.859 4.023 2.273 5.48.432.447.74 1.04.586 1.641a4.483 4.483 0 0 1-.923 1.785A5.969 5.969 0 0 0 6 21c1.282 0 2.47-.402 3.445-1.087.81.22 1.668.337 2.555.337Z" />
              </svg>
            <% end %>
          </div>

          <% if post.user == current_user %>
            <div class="absolute top-2 right-2">
              <%= button_to post_path(post), method: :delete, data: { confirm: "Are you sure?", turbo_confirm: "Are you sure?" }, class: "text-error hover:text-red-700 transition" do %>
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
              <% end %>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  <% end %>
</div>
